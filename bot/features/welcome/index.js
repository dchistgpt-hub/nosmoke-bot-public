/**
 * –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–∞—è —Ñ–∏—á–∞: /start -> –¥–ª–∏–Ω–Ω—ã–π –ø—Ä–∏–≤–µ—Ç + –æ–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ 30 –¥–Ω–µ–π ‚Äî 790 ‚ÇΩ".
 * –ö–Ω–æ–ø–∫–∞ –≤–µ–¥—ë—Ç –Ω–∞ –≤–Ω–µ—à–Ω–∏–π URL –æ–ø–ª–∞—Ç—ã (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ /pay).
 * –¢–µ–∫—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –æ—Ñ–µ—Ä—Ç—É (–∏–∑ OFFER_URL).
 */
const { Markup } = require('telegraf');

function buildWelcomeText(env) {
  const offer = env.OFFER_URL || 'https://example.com/oferta';
  return [
    '–ü—Ä–∏–≤–µ—Ç! üëã –ú—ã ‚Äî –ê–ª–µ–∫—Å–µ–π –∏ –î–º–∏—Ç—Ä–∏–π, —Å–æ–∑–¥–∞—Ç–µ–ª–∏ <b>AI Chatnzt ‚Äî –ù–∏–∫–æ—Ç–∏–Ω–æ–∑–∞–≤–∏—Å–∏–º–∞—è —Ç–µ—Ä–∞–ø–∏—è</b>.',
    '',
    '–ï—Å–ª–∏ —Ç—ã —á–∏—Ç–∞–µ—à—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∑–Ω–∞—á–∏—Ç –≤–Ω—É—Ç—Ä–∏ —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å –∂–µ–ª–∞–Ω–∏–µ –∏–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç —Å–∏–≥–∞—Ä–µ—Ç. –ò –º—ã –∑–Ω–∞–µ–º, –∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã —ç—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å –ª–µ–≥–∫–æ, –±–µ–∑ —Å—Ä—ã–≤–æ–≤ –∏ –º—É–∫.',
    '',
    '–ù–∞—à AI ‚Äî –Ω–µ –ø—Ä–æ—Å—Ç–æ ¬´—É–º–Ω—ã–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫¬ª. –≠—Ç–æ –Ω–µ–π—Ä–æ—Å–µ—Ç—å, –Ω–∞—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ —Å–æ—Ç–Ω—è—Ö —Ç—ã—Å—è—á –Ω–∞—É—á–Ω—ã—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–π –∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –∏—Å—Ç–æ—Ä–∏–π –ª—é–¥–µ–π, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –∏–∑–±–∞–≤–∏–ª–∏—Å—å –æ—Ç –∫—É—Ä–µ–Ω–∏—è. –ú—ã —Å–æ–±—Ä–∞–ª–∏ –æ–ø—ã—Ç –ª—É—á—à–∏—Ö –º–µ—Ç–æ–¥–∏–∫, –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π –∏ –∂–∏–≤—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ –ø–æ–±–µ–¥ –Ω–∞–¥ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é, —á—Ç–æ–±—ã —Ç–≤–æ–π –ø—É—Ç—å –±—ã–ª –ª–µ–≥—á–µ –∏ –∫–æ—Ä–æ—á–µ.',
    '',
    '–û–Ω–∞ –∏–∑—É—á–∞–µ—Ç —Ç–≤–æ–∏ –ø—Ä–∏–≤—ã—á–∫–∏, –Ω–∞—Ö–æ–¥–∏—Ç –º–æ–º–µ–Ω—Ç—ã, –∫–æ–≥–¥–∞ —Ç—ã –æ—Å–æ–±–µ–Ω–Ω–æ —É—è–∑–≤–∏–º –ø–µ—Ä–µ–¥ —Å–∏–≥–∞—Ä–µ—Ç–æ–π, –∏ –∏–º–µ–Ω–Ω–æ –≤ —ç—Ç–∏ –º–∏–Ω—É—Ç—ã –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –¥–µ–ª–∞—Ç—å, —á—Ç–æ–±—ã –Ω–µ —Å–æ—Ä–≤–∞—Ç—å—Å—è.',
    '',
    'üî• –¢—ã –±–æ–ª—å—à–µ –Ω–µ –æ–¥–∏–Ω –Ω–∞ —ç—Ç–æ–π –≤–æ–π–Ω–µ. –ú—ã –±—É–¥–µ–º —Ä—è–¥–æ–º 24/7 ‚Äî –≤ —Ç–≤–æ—ë–º —Ç–µ–ª–µ—Ñ–æ–Ω–µ, –≤ –∫–∞–∂–¥–æ–º –º–æ–º–µ–Ω—Ç–µ, –∫–æ–≥–¥–∞ —Ä—É–∫–∞ —Ç—è–Ω–µ—Ç—Å—è –∑–∞ –ø–∞—á–∫–æ–π.',
    '',
    'üí≥ –°—Ç–æ–∏–º–æ—Å—Ç—å –∫—É—Ä—Å–∞: <b>790 —Ä—É–±.</b>',
    '‚è≥ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: <b>30 –¥–Ω–µ–π</b>.',
    '',
    '–ï—Å–ª–∏ —Ç—ã –≥–æ—Ç–æ–≤ —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–≤—ã–π —à–∞–≥ ‚Äî –∂–º–∏ ¬´–û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ 30 –¥–Ω–µ–π ‚Äî 790 ‚ÇΩ¬ª –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.',
    '',
    '–ü—Ä–æ–¥–æ–ª–∂–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å <a href="' + offer + '">—É—Å–ª–æ–≤–∏—è–º–∏ –æ—Ñ–µ—Ä—Ç—ã</a>.',
    '',
    '–ú–æ–∏ –∫–æ–º–∞–Ω–¥—ã: /ping, /echo, /quiet, /stats, /health, /uptime, /version, /about'
  ].join('\n');
}

function payUrl(env) {
  const domain = env.DOMAIN || 'https://bot.chatnzt.ru';
  // –Ω–∞ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É —É —Ç–µ–±—è —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø–ª–∞—Ç—ë–∂–Ω—ã–π UI
  return null; // unused
}

module.exports.register = function register(bot) {
  const text = buildWelcomeText(process.env);
  const url  = payUrl(process.env);

  bot.start(async (ctx) => {
    try {
      await ctx.reply(text, {
        parse_mode: 'HTML',
        disable_web_page_preview: true,
        ...Markup.inlineKeyboard([
          [Markup.button.callback('–û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ 30 –¥–Ω–µ–π ‚Äî 790 ‚ÇΩ', 'yk:sub:790')]
        ])
      });
      console.log('welcome: sent /start to', ctx.from && ctx.from.id);
    } catch (e) {
      console.error('welcome: /start error:', (e && e.message) || e);
    }
  });
};
