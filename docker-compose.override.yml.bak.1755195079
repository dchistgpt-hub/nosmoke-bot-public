services:
  # сайд-сервер юкассы (порт 3102)
  yk:
    image: nosmoke-bot-bot
    command: ["node","/app/yk-webhook-server.js"]
    restart: unless-stopped
    environment:
      YK_WEBHOOK_LOGIN: "yk_user"
      YK_WEBHOOK_PASSWORD: "super-secret"
    depends_on:
      - mongo

  # отдельный нотификатор платежей (чтобы не пропадал при рестарте bot)
  payments:
    image: nosmoke-bot-bot
    entrypoint: ["node"]
    command: ["/app/payments-notifier.js"]
    restart: unless-stopped
    env_file:
      - .env
    environment:
      QUIET_OVERRIDE_PAYMENTS: "0"   # шлём покупателю
      ALERT_PAYMENTS: "1"            # шлём админу
      ADMIN_TG_ID: "363098548"
    volumes:
      - ./payments-notifier.js:/app/payments-notifier.js:ro
    depends_on:
      - mongo
